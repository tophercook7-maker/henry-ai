<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Henry AI - Advanced AI Assistant</title>
    <style>
        /* Advanced Henry AI Styling with Aura Effects */
        :root {
            --bg-primary: #0a0e15;
            --bg-secondary: #121824;
            --bg-panel: #1a2230;
            --bg-card: #242c3c;
            --text-primary: #e6f1ff;
            --text-secondary: #a8b3cf;
            --accent-blue: #7aa2ff;
            --accent-purple: #bb9af7;
            --accent-green: #9ece6a;
            --accent-orange: #ff9e64;
            --border-color: #2a3245;
            --shadow-color: rgba(122, 162, 255, 0.1);
            --glow-color: rgba(122, 162, 255, 0.3);
            --gradient-primary: linear-gradient(135deg, #7aa2ff 0%, #bb9af7 100%);
            --gradient-secondary: linear-gradient(135deg, #9ece6a 0%, #ff9e64 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Inter, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
        }

        /* Aurora Background Effect */
        .aurora-bg {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at top right, rgba(122, 162, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at bottom left, rgba(187, 154, 247, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at center, rgba(158, 206, 106, 0.1) 0%, transparent 70%);
            animation: aurora-pulse 8s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes aurora-pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }

        /* Main Layout */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 70px 1fr 60px;
            height: 100vh;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin: 10px;
            overflow: hidden;
            box-shadow: 0 20px 40px var(--shadow-color);
        }

        /* Enhanced Topbar */
        .topbar {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            padding: 0 24px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .topbar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--gradient-primary);
            animation: shimmer-line 3s ease-in-out infinite;
        }

        @keyframes shimmer-line {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .brand {
            font-size: 20px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px var(--glow-color);
            animation: brand-glow 2s ease-in-out infinite alternate;
        }

        @keyframes brand-glow {
            from { filter: drop-shadow(0 0 5px var(--glow-color)); }
            to { filter: drop-shadow(0 0 15px var(--glow-color)); }
        }

        .topbar-center {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: status-pulse 2s infinite;
        }

        @keyframes status-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pill {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .pill:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 0 10px var(--glow-color);
        }

        /* Enhanced Sidebar */
        .sidebar {
            background: var(--bg-panel);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .sidebar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(to bottom, transparent, var(--accent-blue), transparent);
            opacity: 0.3;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sidebar-title::before {
            content: '';
            width: 3px;
            height: 3px;
            border-radius: 50%;
            background: var(--accent-blue);
            animation: dot-pulse 1.5s infinite;
        }

        @keyframes dot-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .nav-button {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 10px 14px;
            margin-bottom: 6px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(122, 162, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav-button:hover::before {
            left: 100%;
        }

        .nav-button:hover {
            border-color: var(--accent-blue);
            background: var(--bg-card);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .nav-button.active {
            border-color: var(--accent-blue);
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            box-shadow: 0 4px 16px var(--glow-color);
        }

        .nav-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Enhanced Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            position: relative;
        }

        .main-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(122, 162, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(187, 154, 247, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .panel {
            flex: 1;
            display: none;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        .panel.active {
            display: flex;
        }

        /* Enhanced Chat Panel */
        .chat-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-panel);
            backdrop-filter: blur(10px);
        }

        .chat-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .chat-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: message-slide 0.3s ease-out;
        }

        @keyframes message-slide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--gradient-primary);
            color: white;
        }

        .message.assistant .message-avatar {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            position: relative;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .message.user .message-bubble {
            background: var(--gradient-primary);
            color: white;
            border: none;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .action-button {
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: transparent;
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-button:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        /* Enhanced Input Area */
        .chat-input-container {
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-panel);
            backdrop-filter: blur(10px);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            min-height: 48px;
            max-height: 120px;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px var(--shadow-color);
        }

        .send-button {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .send-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .send-button:hover::before {
            left: 100%;
        }

        .send-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 24px var(--shadow-color);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Connections Panel */
        .connections-panel {
            padding: 24px;
            overflow-y: auto;
        }

        .connections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .connection-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .connection-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .connection-card:hover::before {
            opacity: 1;
        }

        .connection-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow-color);
            border-color: var(--accent-blue);
        }

        .connection-card.connected {
            border-color: var(--accent-green);
            box-shadow: 0 4px 16px rgba(158, 206, 106, 0.2);
        }

        .connection-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .connection-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
        }

        .connection-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .connection-info p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
        }

        .status-indicator.connected {
            background: var(--accent-green);
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Loading Animations */
        .loading-dots {
            display: flex;
            gap: 4px;
        }

        .loading-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-blue);
            animation: loading-dot 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loading-dot {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                margin: 5px;
            }
            
            .sidebar {
                display: none;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-blue);
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="aurora-bg"></div>
    
    <div class="app-container">
        <!-- Enhanced Topbar -->
        <div class="topbar">
            <div class="brand">üß† Henry AI</div>
            <div class="topbar-center">
                <div class="connection-status">
                    <div class="status-dot"></div>
                    <span>Auto-Connections Active</span>
                </div>
            </div>
            <div class="topbar-right">
                <div class="pill">Model: <span id="pill-model">Advanced</span></div>
                <div class="pill">Tokens: <span id="pill-tokens">0</span></div>
                <div class="pill">$<span id="pill-cost">0.00</span></div>
            </div>
        </div>

        <!-- Enhanced Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">‚ú® Quick Access</div>
                <button class="nav-button active" data-panel="chat">
                    <span class="nav-icon">üí¨</span>
                    <span>AI Chat</span>
                </button>
                <button class="nav-button" data-panel="connections">
                    <span class="nav-icon">üîó</span>
                    <span>Connections</span>
                </button>
                <button class="nav-button" data-panel="projects">
                    <span class="nav-icon">üìÅ</span>
                    <span>Projects</span>
                </button>
                <button class="nav-button" data-panel="tools">
                    <span class="nav-icon">üõ†Ô∏è</span>
                    <span>Tools</span>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">‚ö° Automations</div>
                <button class="nav-button" data-panel="automations">
                    <span class="nav-icon">ü§ñ</span>
                    <span>Auto-Tasks</span>
                </button>
                <button class="nav-button" data-panel="integrations">
                    <span class="nav-icon">üîå</span>
                    <span>Integrations</span>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">‚öôÔ∏è System</div>
                <button class="nav-button" data-panel="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </button>
                <button class="nav-button" data-panel="help">
                    <span class="nav-icon">‚ùì</span>
                    <span>Help & Guide</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Chat Panel -->
            <div class="panel active" id="chat-panel">
                <div class="chat-header">
                    <div class="chat-title">AI Assistant</div>
                    <div class="chat-subtitle">Advanced conversational AI with multi-mode support</div>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <div class="message assistant">
                        <div class="message-avatar">üß†</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                Welcome to Henry AI Advanced! ‚ú®
                                
                                I'm your intelligent assistant with:
                                ‚Ä¢ üéØ Multi-mode AI (General/Writer/Developer)
                                ‚Ä¢ üîó Automated connections to services
                                ‚Ä¢ üìÅ Advanced project management
                                ‚Ä¢ ‚ö° Real-time automation tools
                                ‚Ä¢ üåü Sophisticated UI with aura effects
                                
                                Select a mode and start chatting, or explore the Connections tab for automated integrations!
                            </div>
                            <div class="message-actions">
                                <button class="action-button" onclick="saveMessage(this)">Save</button>
                                <button class="action-button" onclick="copyMessage(this)">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea class="chat-input" id="chat-input" placeholder="Ask me anything... Try: 'Connect to my files' or 'Start a writing project'"></textarea>
                        <button class="send-button" id="send-button" onclick="sendMessage()">
                            Send
                        </button>
                    </div>
                </div>
            </div>

            <!-- Connections Panel -->
            <div class="panel" id="connections-panel">
                <div class="connections-header">
                    <h2>üîó Automated Connections</h2>
                    <p>Henry can automatically connect to these services and platforms</p>
                </div>
                <div class="connections-grid" id="connections-grid">
                    <!-- Connection cards will be populated here -->
                </div>
            </div>

            <!-- Projects Panel -->
            <div class="panel" id="projects-panel">
                <div class="projects-header">
                    <h2>üìÅ Project Management</h2>
                    <p>Organize your work with advanced project tools</p>
                </div>
                <div id="projects-content">
                    <!-- Project content will be populated here -->
                </div>
            </div>

            <!-- Tools Panel -->
            <div class="panel" id="tools-panel">
                <div class="tools-header">
                    <h2>üõ†Ô∏è Advanced Tools</h2>
                    <p>Specialized tools for different tasks</p>
                </div>
                <div id="tools-content">
                    <!-- Tools content will be populated here -->
                </div>
            </div>

            <!-- Settings Panel -->
            <div class="panel" id="settings-panel">
                <div class="settings-header">
                    <h2>‚öôÔ∏è Settings & Configuration</h2>
                    <p>Customize Henry AI to your preferences</p>
                </div>
                <div id="settings-content">
                    <!-- Settings content will be populated here -->
                </div>
            </div>

            <!-- Help Panel -->
            <div class="panel" id="help-panel">
                <div class="help-header">
                    <h2>‚ùì Help & Guide</h2>
                    <p>Learn how to use all of Henry's advanced features</p>
                </div>
                <div id="help-content">
                    <!-- Help content will be populated here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        // Henry AI Advanced JavaScript
        class HenryAI {
            constructor() {
                this.apiBase = 'http://127.0.0.1:3000';
                this.currentPanel = 'chat';
                this.connections = [];
                this.projects = [];
                this.automations = [];
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadConnections();
                this.startAutomationEngine();
                this.setupAuraEffects();
            }

            setupEventListeners() {
                // Navigation buttons
                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const panel = e.target.dataset.panel;
                        this.switchPanel(panel);
                    });
                });

                // Chat input
                const chatInput = document.getElementById('chat-input');
                const sendButton = document.getElementById('send-button');
                
                sendButton.addEventListener('click', () => this.sendMessage());
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Auto-focus chat input
                chatInput.focus();
            }

            setupAuraEffects() {
                // Add subtle animations and effects
                const style = document.createElement('style');
                style.textContent = `
                    .nav-button.active::after {
                        content: '';
                        position: absolute;
                        top: 50%;
                        right: -2px;
                        width: 3px;
                        height: 20px;
                        background: var(--accent-blue);
                        border-radius: 2px;
                        transform: translateY(-50%);
                        animation: active-glow 2s ease-in-out infinite alternate;
                    }
                    
                    @keyframes active-glow {
                        from { box-shadow: 0 0 5px var(--accent-blue); }
                        to { box-shadow: 0 0 15px var(--accent-blue); }
                    }
                    
                    .message-bubble {
                        animation: bubble-float 0.5s ease-out;
                    }
                    
                    @keyframes bubble-float {
                        from {
                            opacity: 0;
                            transform: translateY(20px) scale(0.9);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0) scale(1);
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            switchPanel(panelName) {
                // Update active nav button
                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-panel="${panelName}"]`).classList.add('active');

                // Update active panel
                document.querySelectorAll('.panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(`${panelName}-panel`).classList.add('active');

                this.currentPanel = panelName;

                // Load panel-specific content
                switch(panelName) {
                    case 'connections':
                        this.loadConnectionsPanel();
                        break;
                    case 'projects':
                        this.loadProjectsPanel();
                        break;
                    case 'tools':
                        this.loadToolsPanel();
                        break;
                    case 'settings':
                        this.loadSettingsPanel();
                        break;
                    case 'help':
                        this.loadHelpPanel();
                        break;
                }
            }

            async loadConnections() {
                // Simulate loading automated connections
                this.connections = [
                    {
                        id: 'files',
                        name: 'Local Files',
                        icon: 'üìÅ',
                        description: 'Access and manage your local files',
                        status: 'connected',
                        autoConnect: true
                    },
                    {
                        id: 'web',
                        name: 'Web Browser',
                        icon: 'üåê',
                        description: 'Browse and interact with web content',
                        status: 'connected',
                        autoConnect: true
                    },
                    {
                        id: 'github',
                        name: 'GitHub',
                        icon: 'üíª',
                        description: 'Read repositories and manage code',
                        status: 'disconnected',
                        autoConnect: false
                    },
                    {
                        id: 'notion',
                        name: 'Notion',
                        icon: 'üìù',
                        description: 'Access and edit Notion pages',
                        status: 'disconnected',
                        autoConnect: false
                    },
                    {
                        id: 'slack',
                        name: 'Slack',
                        icon: 'üí¨',
                        description: 'Send messages and read channels',
                        status: 'connected',
                        autoConnect: true
                    },
                    {
                        id: 'drive',
                        name: 'Google Drive',
                        icon: 'üóÇÔ∏è',
                        description: 'Access Google Drive files',
                        status: 'disconnected',
                        autoConnect: false
                    }
                ];
            }

            loadConnectionsPanel() {
                const grid = document.getElementById('connections-grid');
                grid.innerHTML = '';

                this.connections.forEach(connection => {
                    const card = document.createElement('div');
                    card.className = `connection-card ${connection.status}`;
                    card.innerHTML = `
                        <div class="connection-header">
                            <div class="connection-icon">${connection.icon}</div>
                            <div class="connection-info">
                                <h3>${connection.name}</h3>
                                <p>${connection.description}</p>
                            </div>
                        </div>
                        <div class="connection-status">
                            <div class="status-indicator ${connection.status}"></div>
                            <span>${connection.status === 'connected' ? 'Connected' : 'Disconnected'}</span>
                            ${connection.autoConnect ? '<span style="margin-left: auto; font-size: 11px; color: var(--accent-green);">Auto</span>' : ''}
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px;">
                            <button class="action-button" onclick="henry.toggleConnection('${connection.id}')">
                                ${connection.status === 'connected' ? 'Disconnect' : 'Connect'}
                            </button>
                            ${connection.status === 'connected' ? '<button class="action-button" onclick="henry.testConnection(\'' + connection.id + '\')">Test</button>' : ''}
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }

            startAutomationEngine() {
                // Start automated connection attempts
                setInterval(() => {
                    this.autoConnectServices();
                }, 30000); // Check every 30 seconds

                // Start status monitoring
                setInterval(() => {
                    this.updateConnectionStatus();
                }, 5000); // Update every 5 seconds
            }

            autoConnectServices() {
                this.connections.forEach(connection => {
                    if (connection.autoConnect && connection.status === 'disconnected') {
                        this.attemptConnection(connection.id);
                    }
                });
            }

            async attemptConnection(connectionId) {
                const connection = this.connections.find(c => c.id === connectionId);
                if (!connection) return;

                console.log(`Attempting to connect to ${connection.name}...`);
                
                // Simulate connection attempt
                setTimeout(() => {
                    connection.status = 'connected';
                    this.loadConnectionsPanel();
                    this.showNotification(`‚úÖ Auto-connected to ${connection.name}`);
                }, 2000);
            }

            toggleConnection(connectionId) {
                const connection = this.connections.find(c => c.id === connectionId);
                if (!connection) return;

                if (connection.status === 'connected') {
                    connection.status = 'disconnected';
                    this.showNotification(`‚ùå Disconnected from ${connection.name}`);
                } else {
                    this.attemptConnection(connectionId);
                }
                
                this.loadConnectionsPanel();
            }

            testConnection(connectionId) {
                const connection = this.connections.find(c => c.id === connectionId);
                if (!connection) return;

                this.showNotification(`üß™ Testing ${connection.name} connection...`);
                
                // Simulate test
                setTimeout(() => {
                    this.showNotification(`‚úÖ ${connection.name} connection is working properly!`);
                }, 1500);
            }

            updateConnectionStatus() {
                // Update the status dot in topbar
                const statusDot = document.querySelector('.status-dot');
                const connectedCount = this.connections.filter(c => c.status === 'connected').length;
                
                if (connectedCount > 0) {
                    statusDot.style.background = 'var(--accent-green)';
                } else {
                    statusDot.style.background = 'var(--text-secondary)';
                }
            }

            showNotification(message) {
                // Create a toast notification
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--bg-card);
                    border: 1px solid var(--border-color);
                    border-radius: 8px;
                    padding: 12px 16px;
                    color: var(--text-primary);
                    font-size: 14px;
                    z-index: 1000;
                    animation: slide-in 0.3s ease-out;
                    box-shadow: 0 4px 12px var(--shadow-color);
                `;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slide-out 0.3s ease-in';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            async sendMessage() {
                const input = document.getElementById('chat-input');
                const message = input.value.trim();
                
                if (!message) return;

                // Add user message
                this.addMessage('user', message);
                input.value = '';
                
                // Show typing indicator
                this.showTypingIndicator();

                try {
                    // Simulate AI response with enhanced features
                    const response = await this.getAIResponse(message);
                    this.hideTypingIndicator();
                    this.addMessage('assistant', response);
                } catch (error) {
                    this.hideTypingIndicator();
                    this.addMessage('assistant', 'Sorry, I encountered an error. Please try again.');
                }
            }

            addMessage(role, text) {
                const messagesContainer = document.getElementById('chat-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;
                
                const avatar = role === 'user' ? 'üë§' : 'üß†';
                const avatarBg = role === 'user' ? 'var(--gradient-primary)' : 'var(--bg-card)';
                
                messageDiv.innerHTML = `
                    <div class="message-avatar" style="background: ${avatarBg}">${avatar}</div>
                    <div class="message-content">
                        <div class="message-bubble">${this.formatMessage(text)}</div>
                        ${role === 'assistant' ? `
                            <div class="message-actions">
                                <button class="action-button" onclick="copyMessage(this)">Copy</button>
                                <button class="action-button" onclick="saveMessage(this)">Save</button>
                                <button class="action-button" onclick="shareMessage(this)">Share</button>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Update token count (simulated)
                this.updateTokenCount(text.length);
            }

            formatMessage(text) {
                // Enhanced formatting with animations
                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong style="color: var(--accent-blue);">$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code style="background: var(--bg-panel); padding: 2px 4px; border-radius: 4px; color: var(--accent-green);">$1</code>')
                    .replace(/^### (.*$)/gm, '<h3 style="color: var(--accent-purple); margin: 8px 0;">$1</h3>')
                    .replace(/^## (.*$)/gm, '<h2 style="color: var(--accent-blue); margin: 12px 0;">$1</h2>')
                    .replace(/^# (.*$)/gm, '<h1 style="color: var(--accent-blue); margin: 16px 0; font-size: 1.2em;">$1</h1>')
                    .replace(/‚Ä¢ (.*)/g, '<div style="margin: 4px 0; padding-left: 16px; position: relative;"><span style="position: absolute; left: 0; color: var(--accent-green);">‚Ä¢</span>$1</div>');
            }

            showTypingIndicator() {
                const messagesContainer = document.getElementById('chat-messages');
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message assistant typing';
                typingDiv.id = 'typing-indicator';
                typingDiv.innerHTML = `
                    <div class="message-avatar" style="background: var(--bg-card);">üß†</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="loading-dots">
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                            </div>
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            hideTypingIndicator() {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            async getAIResponse(message) {
                // Enhanced AI response simulation
                await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000));
                
                const responses = {
                    'hello': 'Hello! üëã I\'m Henry AI with advanced automation capabilities. I can connect to multiple services and provide intelligent assistance across various domains.',
                    'connections': 'I can automatically connect to: üìÅ Local Files, üåê Web Browser, üíª GitHub, üìù Notion, üí¨ Slack, üóÇÔ∏è Google Drive, and many more! Check the Connections tab to see all available integrations.',
                    'automate': 'My automation engine runs continuously in the background, automatically connecting to services, monitoring changes, and executing tasks based on your preferences.',
                    'files': 'I can access your local files, read documents, analyze content, and help you organize your work. Just ask me to browse a folder or read a file!',
                    'project': 'I can help you create and manage projects with intelligent suggestions, automated organization, and seamless integration with your existing tools.',
                    'help': 'I\'m here to help! Try asking me to:\n‚Ä¢ Connect to a service (see Connections tab)\n‚Ä¢ Start a writing or development project\n‚Ä¢ Automate repetitive tasks\n‚Ä¢ Browse and analyze files\n‚Ä¢ Provide expert guidance'
                };

                // Check for specific keywords
                const lowerMessage = message.toLowerCase();
                for (const [key, response] of Object.entries(responses)) {
                    if (lowerMessage.includes(key)) {
                        return response;
                    }
                }

                // Default intelligent response
                return `I understand you're asking about: "${message}"

üß† **Henry AI Advanced Analysis:**
Based on your input, I can help you with intelligent automation, connections to various services, and expert guidance.

**Available Actions:**
‚Ä¢ Check the Connections tab for automated integrations
‚Ä¢ Use project tools for organized workflows  
‚Ä¢ Explore automation features for efficiency
‚Ä¢ Access my multi-mode capabilities (General/Writer/Developer)

What would you like me to help you with specifically?`;
            }

            updateTokenCount(charCount) {
                const tokens = Math.ceil(charCount / 4);
                document.getElementById('pill-tokens').textContent = tokens.toLocaleString();
                
                // Simulate cost calculation
                const cost = (tokens / 1000) * 0.002;
                document.getElementById('pill-cost').textContent = cost.toFixed(4);
            }

            // Panel loading methods
            loadProjectsPanel() {
                const content = document.getElementById('projects-content');
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 16px;">üöÄ Advanced Project Management</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 24px;">
                            Create intelligent projects with automated organization, AI-powered suggestions, and seamless integrations.
                        </p>
                        <div style="display: flex; gap: 16px; justify-content: center;">
                            <button class="send-button" onclick="henry.createProject('book')">
                                üìö Create Book Project
                            </button>
                            <button class="send-button" onclick="henry.createProject('app')">
                                üíª Create App Project
                            </button>
                            <button class="send-button" onclick="henry.createProject('research')">
                                üî¨ Create Research Project
                            </button>
                        </div>
                    </div>
                `;
            }

            loadToolsPanel() {
                const content = document.getElementById('tools-content');
                content.innerHTML = `
                    <div class="connections-grid">
                        <div class="connection-card">
                            <div class="connection-header">
                                <div class="connection-icon">üìù</div>
                                <div class="connection-info">
                                    <h3>Writing Assistant</h3>
                                    <p>Advanced writing tools with AI suggestions</p>
                                </div>
                            </div>
                            <button class="action-button" onclick="henry.openTool('writing')">Open Tool</button>
                        </div>
                        <div class="connection-card">
                            <div class="connection-header">
                                <div class="connection-icon">üíª</div>
                                <div class="connection-info">
                                    <h3>Code Generator</h3>
                                    <p>Full-stack development assistance</p>
                                </div>
                            </div>
                            <button class="action-button" onclick="henry.openTool('code')">Open Tool</button>
                        </div>
                        <div class="connection-card">
                            <div class="connection-header">
                                <div class="connection-icon">üîç</div>
                                <div class="connection-info">
                                    <h3>Research Assistant</h3>
                                    <p>Intelligent research and analysis</p>
                                </div>
                            </div>
                            <button class="action-button" onclick="henry.openTool('research')">Open Tool</button>
                        </div>
                    </div>
                `;
            }

            loadSettingsPanel() {
                const content = document.getElementById('settings-content');
                content.innerHTML = `
                    <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
                        <h3 style="color: var(--accent-blue); margin-bottom: 20px;">üé® Appearance</h3>
                        <div style="margin-bottom: 32px;">
                            <label style="display: block; margin-bottom: 8px; color: var(--text-secondary);">Theme</label>
                            <select class="chat-input" style="width: 200px;" onchange="henry.changeTheme(this.value)">
                                <option value="dark">Dark (Default)</option>
                                <option value="light">Light</option>
                                <option value="auto">Auto</option>
                            </select>
                        </div>
                        
                        <h3 style="color: var(--accent-blue); margin-bottom: 20px;">‚ö° Automation</h3>
                        <div style="margin-bottom: 32px;">
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" checked onchange="henry.toggleAutoConnect(this.checked)">
                                <span>Auto-connect to services</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                <input type="checkbox" checked onchange="henry.toggleAutoSave(this.checked)">
                                <span>Auto-save conversations</span>
                            </label>
                        </div>
                        
                        <h3 style="color: var(--accent-blue); margin-bottom: 20px;">üîå API Configuration</h3>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: var(--text-secondary);">API Base URL</label>
                            <input type="text" class="chat-input" style="width: 100%;" value="http://127.0.0.1:3000" onchange="henry.updateApiUrl(this.value)">
                        </div>
                    </div>
                `;
            }

            loadHelpPanel() {
                const content = document.getElementById('help-content');
                content.innerHTML = `
                    <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
                        <h2 style="color: var(--accent-blue); margin-bottom: 24px;">üöÄ Henry AI Advanced Guide</h2>
                        
                        <div style="margin-bottom: 32px;">
                            <h3 style="color: var(--accent-purple); margin-bottom: 16px;">‚ú® Key Features</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="margin-bottom: 12px;">üéØ <strong>Multi-Mode AI:</strong> Switch between General, Writer, and Developer modes</li>
                                <li style="margin-bottom: 12px;">üîó <strong>Automated Connections:</strong> Auto-connect to files, web, GitHub, etc.</li>
                                <li style="margin-bottom: 12px;">üìÅ <strong>Project Management:</strong> Intelligent project organization</li>
                                <li style="margin-bottom: 12px;">‚ö° <strong>Real-time Automation:</strong> Background task execution</li>
                                <li style="margin-bottom: 12px;">üåü <strong>Fancy UI:</strong> Aura effects and smooth animations</li>
                            </ul>
                        </div>
                        
                        <div style="margin-bottom: 32px;">
                            <h3 style="color: var(--accent-purple); margin-bottom: 16px;">üéÆ Quick Commands</h3>
                            <div style="background: var(--bg-card); padding: 16px; border-radius: 8px; border: 1px solid var(--border-color);">
                                <p style="margin-bottom: 8px;"><code>"Connect to my files"</code> - Access local file system</p>
                                <p style="margin-bottom: 8px;"><code>"Start a writing project"</code> - Create book/documentation project</p>
                                <p style="margin-bottom: 8px;"><code>"Browse GitHub"</code> - Connect to GitHub repositories</p>
                                <p style="margin-bottom: 8px;"><code>"Automate this task"</code> - Set up automation rules</p>
                                <p><code>"Help with code"</code> - Switch to developer mode</p>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: var(--accent-purple); margin-bottom: 16px;">üìû Support</h3>
                            <p>Need help? Henry AI is designed to be intuitive, but if you need assistance:</p>
                            <ul style="margin-top: 12px; color: var(--text-secondary);">
                                <li>Check the Connections tab for service status</li>
                                <li>Use the Settings panel to customize behavior</li>
                                <li>Ask me directly for help with specific features</li>
                            </ul>
                        </div>
                    </div>
                `;
            }

            // Utility methods
            createProject(type) {
                this.showNotification(`üöÄ Creating ${type} project...`);
                // Simulate project creation
                setTimeout(() => {
                    this.showNotification(`‚úÖ ${type.charAt(0).toUpperCase() + type.slice(1)} project created successfully!`);
                }, 2000);
            }

            openTool(toolType) {
                this.showNotification(`üîß Opening ${toolType} tool...`);
                // Simulate tool opening
                setTimeout(() => {
                    this.showNotification(`‚úÖ ${toolType.charAt(0).toUpperCase() + toolType.slice(1)} tool is ready!`);
                }, 1500);
            }

            changeTheme(theme) {
                this.showNotification(`üé® Theme changed to ${theme}`);
            }

            toggleAutoConnect(enabled) {
                this.showNotification(`üîó Auto-connect ${enabled ? 'enabled' : 'disabled'}`);
            }

            toggleAutoSave(enabled) {
                this.showNotification(`üíæ Auto-save ${enabled ? 'enabled' : 'disabled'}`);
            }

            updateApiUrl(url) {
                this.apiBase = url.replace(/\/+$/, '');
                this.showNotification(`üîå API URL updated to ${url}`);
            }
        }

        // Global functions for HTML onclick handlers
        function sendMessage() {
            henry.sendMessage();
        }

        function copyMessage(button) {
            const bubble = button.closest('.message-content').querySelector('.message-bubble');
            const text = bubble.textContent;
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => button.textContent = 'Copy', 2000);
            });
        }

        function saveMessage(button) {
            const bubble = button.closest('.message-content').querySelector('.message-bubble');
            const text = bubble.textContent;
            henry.showNotification('üíæ Message saved to project!');
            button.textContent = 'Saved!';
            setTimeout(() => button.textContent = 'Save', 2000);
        }

        function shareMessage(button) {
            henry.showNotification('üì§ Share functionality coming soon!');
        }

        // Initialize Henry AI
        const henry = new HenryAI();

        // Add some initial animations
        document.addEventListener('DOMContentLoaded', () => {
            // Animate sidebar items
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach((btn, index) => {
                btn.style.animationDelay = `${index * 0.1}s`;
                btn.style.animation = 'fade-in 0.5s ease-out forwards';
            });
        });

        // Add fade-in animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fade-in {
                from {
                    opacity: 0;
                    transform: translateX(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>